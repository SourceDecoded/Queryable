{"version":3,"sources":["../src/Queryable.js"],"names":["assertHasProvider","queryable","provider","Error","copyQuery","copy","where","query","orderBy","include","parameters","JSON","parse","stringify","take","skip","Queryable","type","nodeName","Infinity","lambda","rightExpression","getQuery","call","children","length","push","leftExpression","pop","or","and","value","propertyExpression","getExpression","descendingExpression","descending","contains","ascendingExpression","ascending","params","Object","keys","forEach","key","expression","clone","cloneQuery","toArrayAsync","countAsync","toArrayWithCountAsync"],"mappings":"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","file":"Queryable.js","sourcesContent":["import { Expression, ValueExpression, OperationExpression } from \"./Expression\";\nimport { ExpressionBuilder, OperationExpressionBuilder } from \"./ExpressionBuilder\";\n\nconst assertHasProvider = queryable => {\n    if (!queryable.provider) {\n        throw new Error(\"No provider found.\");\n    }\n};\n\nconst copyQuery = query => {\n    var copy = {};\n\n    copy.where = query.where.copy();\n    copy.orderBy = query.orderBy.copy();\n    copy.include = query.include.copy();\n    copy.parameters = JSON.parse(JSON.stringify(query.parameters));\n    copy.take = query.take;\n    copy.skip = query.skip;\n\n    return copy;\n};\n\nexport default class Queryable {\n    constructor(type, query) {\n        query = query || {};\n\n        this.type = type || \"Object\";\n        this.provider = null;\n        this.query = {};\n        this.query.parameters = (query && query.parameters) || {};\n\n        if (query.where != null && query.where.nodeName === \"where\") {\n            this.query.where = query.where;\n        } else {\n            this.query.where = Expression.where();\n        }\n\n        if (query.skip != null && query.skip.nodeName === \"skip\") {\n            this.query.skip = query.skip;\n        } else {\n            this.query.skip = Expression.skip(0);\n        }\n\n        if (query.take != null && query.take.nodeName === \"take\") {\n            this.query.take = query.take;\n        } else {\n            this.query.take = Expression.take(Infinity);\n        }\n\n        if (query.include != null && query.include.nodeName === \"include\") {\n            this.query.include = query.include;\n        } else {\n            this.query.include = Expression.include();\n        }\n\n        if (query.orderBy != null && query.orderBy.nodeName === \"orderBy\") {\n            this.query.orderBy = query.orderBy;\n        } else {\n            this.query.orderBy = Expression.orderBy();\n        }\n    }\n\n    getExpression() {\n        return this.query;\n    }\n\n    getQuery() {\n        return this.query;\n    }\n\n    or(lambda) {\n        var rightExpression;\n        var query = copyQuery(this.getQuery());\n\n        if (typeof lambda === \"function\") {\n            lambda = lambda || function() {};\n            rightExpression = lambda.call(ExpressionBuilder, new ExpressionBuilder(this.type));\n        } else if (lambda instanceof Expression) {\n            rightExpression = lambda;\n        } else {\n            throw new Error(\"Expected an expression to be supplied.\");\n        }\n\n        if (query.where.children.length === 0) {\n            query.where.children.push(rightExpression);\n        } else {\n            var leftExpression = query.where.children.pop();\n            query.where.children.push(Expression.or(leftExpression, rightExpression));\n        }\n\n        return this.copy(query);\n    }\n\n    where(lambda) {\n        var rightExpression;\n        var query = copyQuery(this.getQuery());\n\n        if (typeof lambda === \"function\") {\n            lambda = lambda || function() {};\n            rightExpression = lambda.call(ExpressionBuilder, new ExpressionBuilder(this.type));\n        } else if (lambda instanceof Expression) {\n            rightExpression = lambda;\n        } else {\n            throw new Error(\"Expected an expression to be supplied.\");\n        }\n\n        if (query.where.children.length === 0) {\n            query.where.children.push(rightExpression);\n        } else {\n            var leftExpression = query.where.children.pop();\n            query.where.children.push(Expression.and(leftExpression, rightExpression));\n        }\n\n        return this.copy(query);\n    }\n\n    and(lambda) {\n        return this.where(lambda);\n    }\n\n    take(value) {\n        if (typeof value !== \"number\") {\n            throw new Error(\"Illegal Argument Exception: value needs to be a number.\");\n        }\n\n        var query = copyQuery(this.getQuery());\n        query.take = Expression.take(value);\n\n        return this.copy(query);\n    }\n\n    skip(value) {\n        if (typeof value !== \"number\") {\n            throw new Error(\"Illegal Argument Exception: value needs to be a number.\");\n        }\n\n        var query = copyQuery(this.getQuery());\n        query.skip = Expression.skip(value);\n\n        return this.copy(query);\n    }\n\n    orderByDesc(lambda) {\n        var propertyExpression;\n        var query = copyQuery(this.getQuery());\n\n        if (typeof lambda === \"function\") {\n            lambda = lambda || function() {};\n            propertyExpression = lambda.call(ExpressionBuilder, new ExpressionBuilder(this.type)).getExpression();\n        } else if (lambda instanceof OperationExpressionBuilder) {\n            propertyExpression = lambda.getExpression();\n        } else {\n            throw new Error(\"Expected a property to orderByDesc.\");\n        }\n\n        var descendingExpression = Expression.descending(propertyExpression);\n\n        if (!query.orderBy.contains(propertyExpression)) {\n            query.orderBy.children.push(descendingExpression);\n            return this.copy(query);\n        } else {\n            return this;\n        }\n    }\n\n    orderBy(lambda) {\n        var propertyExpression;\n        var query = copyQuery(this.getQuery());\n\n        if (typeof lambda === \"function\") {\n            lambda = lambda || function() {};\n            propertyExpression = lambda.call(ExpressionBuilder, new ExpressionBuilder(this.type)).getExpression();\n        } else if (lambda instanceof OperationExpressionBuilder) {\n            propertyExpression = lambda.getExpression();\n        } else {\n            throw new Error(\"Expected a property to orderBy.\");\n        }\n\n        var ascendingExpression = Expression.ascending(propertyExpression);\n\n        if (!query.orderBy.contains(propertyExpression)) {\n            query.orderBy.children.push(ascendingExpression);\n            return this.copy(query);\n        } else {\n            return this;\n        }\n    }\n\n    setParameters(params) {\n        if (!params) {\n            throw new Error(\"Expected parameters to be passed in.\");\n        }\n        var parameters = this.query.parameters;\n\n        Object.keys(params).forEach(function(key) {\n            parameters[key] = params[key];\n        });\n        return this;\n    }\n\n    withParameters(params) {\n        if (!params) {\n            throw new Error(\"Expected parameters to be passed in.\");\n        }\n\n        var parameters = (this.query.parameters = {});\n        Object.keys(params).forEach(function(key) {\n            parameters[key] = params[key];\n        });\n        return this;\n    }\n\n    include(lambda) {\n        var propertyExpression;\n        var query = copyQuery(this.getQuery());\n\n        if (typeof lambda === \"function\") {\n            lambda = lambda || function() {};\n            propertyExpression = lambda.call(ExpressionBuilder, new ExpressionBuilder(this.type)).getExpression();\n        } else if (lambda instanceof OperationExpressionBuilder) {\n            propertyExpression = lambda.getExpression();\n        } else {\n            throw new Error(\"Expected a property to include.\");\n        }\n\n        if (propertyExpression.nodeName !== \"queryable\") {\n            propertyExpression = Expression.queryable(propertyExpression, Expression.expression(Expression.where()));\n        }\n\n        query.include.children.push(propertyExpression);\n        return this.copy(query);\n    }\n\n    merge(queryable) {\n        if (!(queryable instanceof Queryable)) {\n            throw new Error(\"Expected a queryable to be passed in.\");\n        }\n\n        var clone = this.copy();\n        var cloneQuery = clone.getQuery();\n        var query = queryable.getQuery();\n        var rightExpression = query.where.children[0];\n\n        if (rightExpression != null) {\n            // No need to copy if there is nothing to copy.\n            if (cloneQuery.where.children.length === 0) {\n                cloneQuery.where.children.push(rightExpression.copy());\n            } else if (cloneQuery.where.children.length === 1 && cloneQuery.where.children[0].nodeName === \"and\") {\n                cloneQuery.where.children[0].children.push(rightExpression.copy());\n            } else {\n                var leftExpression = cloneQuery.where.children.pop();\n                cloneQuery.where.children.push(Expression.and(leftExpression, rightExpression.copy()));\n            }\n        }\n\n        query.include.children.forEach(function(expression) {\n            cloneQuery.include.children.push(expression.copy());\n        });\n\n        query.orderBy.children.forEach(function(expression) {\n            if (!cloneQuery.orderBy.contains(expression)) {\n                cloneQuery.orderBy.children.push(expression.copy());\n            }\n        });\n\n        return this.copy(cloneQuery);\n    }\n\n    toArrayAsync() {\n        assertHasProvider(this);\n        return this.provider.toArrayAsync(this);\n    }\n\n    countAsync() {\n        assertHasProvider(this);\n        return this.provider.countAsync(this);\n    }\n\n    toArrayWithCountAsync() {\n        assertHasProvider(this);\n        return this.provider.toArrayWithCountAsync(this);\n    }\n\n    ofType(type) {\n        var queryable = new Queryable(type);\n        queryable.provider = this.provider;\n        return queryable;\n    }\n\n    copy(query) {\n        var queryable = new Queryable(this.type, query || copyQuery(this.query));\n        queryable.provider = this.provider;\n        return queryable;\n    }\n}\n"]}